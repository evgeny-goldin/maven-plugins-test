<?xml version="1.0" encoding="UTF-8"?>

<project xmlns              = "http://maven.apache.org/POM/4.0.0"
         xmlns:xsi          = "http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation = "http://maven.apache.org/POM/4.0.0
                               http://maven.apache.org/maven-v4_0_0.xsd">

    <modelVersion>4.0.0</modelVersion>
    <groupId>com.goldin.plugins.maven-plugins-test</groupId>
    <artifactId>maven-copy-plugin.issues.0.2.3.5</artifactId>
    <packaging>jar</packaging>
    <version>0.1-SNAPSHOT</version>
    <name>[${project.groupId}:${project.artifactId}:${project.version}]</name>


    <parent>
        <groupId>com.goldin.plugins.maven-plugins-test</groupId>
        <artifactId>maven-copy-plugin.issues</artifactId>
        <version>0.1-SNAPSHOT</version>
    </parent>


    <build>
        <plugins>
            <plugin>
                <groupId>com.goldin.plugins</groupId>
                <artifactId>maven-copy-plugin</artifactId>
                <version>${plugins-version}</version>
                <executions>
                    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
                    <!-- http://evgeny-goldin.org/youtrack/issue/pl-502:                   -->
                    <!-- "Treat <nonFilteredExtensions> for non-replaceable files as well" -->
                    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
                    <execution>
                        <id>http://evgeny-goldin.org/youtrack/issue/pl-502</id>
                        <goals>
                            <goal>copy</goal>
                        </goals>
                        <phase>initialize</phase>
                        <configuration>
                            <resources>
                                <resource>
                                    <targetPath>${outputDir}/pl-502</targetPath>
                                    <dependency>
                                        <groupId>org.codehaus.groovy</groupId>
                                        <artifactId>groovy-all</artifactId>
                                        <version>1.8.3</version>
                                    </dependency>
                                    <destFileName>groovy-all.jar</destFileName>
                                </resource>
                                <resource>
                                    <targetPath>${outputDir}/pl-502/1</targetPath>
                                    <file>${outputDir}/pl-502/groovy-all.jar</file>
                                    <unpack>true</unpack>
                                </resource>
                                <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
                                <!-- Copying with and without replaces -->
                                <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
                                <resource>
                                    <targetPath>${outputDir}/pl-502/copy-1</targetPath>
                                    <directory>${outputDir}/pl-502/1</directory>
                                    <verbose>false</verbose>
                                    <preservePath>true</preservePath>
                                    <replace>
                                        <from>.</from>
                                        <to>!</to>
                                    </replace>
                                </resource>
                                <resource>
                                    <targetPath>${outputDir}/pl-502/copy-2</targetPath>
                                    <directory>${outputDir}/pl-502/1</directory>
                                    <verbose>false</verbose>
                                    <preservePath>true</preservePath>
                                    <replace>
                                        <from>.</from>
                                        <to>!</to>
                                    </replace>
                                    <nonFilteredExtensions>class, xml</nonFilteredExtensions>
                                </resource>
                                <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
                                <!-- Unpacking with and without replaces -->
                                <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
                                <resource>
                                    <targetPath>${outputDir}/pl-502/unpack-1</targetPath>
                                    <file>${outputDir}/pl-502/groovy-all.jar</file>
                                    <unpack>true</unpack>
                                    <replace>
                                        <from>.</from>
                                        <to>!</to>
                                    </replace>
                                </resource>
                                <resource>
                                    <targetPath>${outputDir}/pl-502/unpack-2</targetPath>
                                    <file>${outputDir}/pl-502/groovy-all.jar</file>
                                    <unpack>true</unpack>
                                    <replace>
                                        <from>.</from>
                                        <to>!</to>
                                    </replace>
                                    <nonFilteredExtensions>class, xml</nonFilteredExtensions>
                                </resource>
                                <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
                                <!-- Packing with and without replaces -->
                                <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
                                <resource>
                                    <targetPath>${outputDir}/pl-502/pack-1/groovy-all.jar</targetPath>
                                    <directory>${outputDir}/pl-502/1</directory>
                                    <pack>true</pack>
                                    <replace>
                                        <from>.</from>
                                        <to>!</to>
                                    </replace>
                                </resource>
                                <resource>
                                    <targetPath>${outputDir}/pl-502/pack-1/unpack</targetPath>
                                    <file>${outputDir}/pl-502/pack-1/groovy-all.jar</file>
                                    <unpack>true</unpack>
                                </resource>
                                <resource>
                                    <targetPath>${outputDir}/pl-502/pack-2/groovy-all.jar</targetPath>
                                    <directory>${outputDir}/pl-502/1</directory>
                                    <pack>true</pack>
                                    <replace>
                                        <from>.</from>
                                        <to>!</to>
                                    </replace>
                                    <nonFilteredExtensions>class, xml</nonFilteredExtensions>
                                </resource>
                                <resource>
                                    <targetPath>${outputDir}/pl-502/pack-2/unpack</targetPath>
                                    <file>${outputDir}/pl-502/pack-2/groovy-all.jar</file>
                                    <unpack>true</unpack>
                                </resource>
                            </resources>
                        </configuration>
                    </execution>
                    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
                    <!-- http://evgeny-goldin.org/youtrack/issue/pl-493                    -->
                    <!-- "Avoid unpacking files that have been unpacked by a previous run" -->
                    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
                    <execution>
                        <id>http://evgeny-goldin.org/youtrack/issue/pl-493-1</id>
                        <goals>
                            <goal>copy</goal>
                        </goals>
                        <phase>initialize</phase>
                        <configuration>
                            <skipUnpacked>true</skipUnpacked>
                            <resources>
                                <resource>
                                    <description>unpack-groovy-1</description>
                                    <targetPath>${outputDir}/pl-493/unpack</targetPath>
                                    <dependency>
                                        <groupId>org.codehaus.groovy</groupId>
                                        <artifactId>groovy-all</artifactId>
                                        <version>1.9.0-beta-4</version>
                                    </dependency>
                                    <unpack>true</unpack>
                                </resource>
                                <resource>
                                    <description>unpack-groovy-2</description>
                                    <targetPath>${outputDir}/pl-493/unpack</targetPath>
                                    <dependency>
                                        <groupId>org.codehaus.groovy</groupId>
                                        <artifactId>groovy-all</artifactId>
                                        <version>1.9.0-beta-4</version>
                                    </dependency>
                                    <unpack>true</unpack>
                                </resource>
                            </resources>
                        </configuration>
                    </execution>
                    <execution>
                        <id>http://evgeny-goldin.org/youtrack/issue/pl-493-2</id>
                        <goals>
                            <goal>copy</goal>
                        </goals>
                        <phase>initialize</phase>
                        <configuration>
                            <resource>
                                <description>unpack-groovy-3</description>
                                <targetPath>${outputDir}/pl-493/unpack</targetPath>
                                <dependency>
                                    <groupId>org.codehaus.groovy</groupId>
                                    <artifactId>groovy-all</artifactId>
                                    <version>1.9.0-beta-4</version>
                                </dependency>
                                <skipUnpacked>true</skipUnpacked>
                                <unpack>true</unpack>
                            </resource>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

            <plugin>
                <groupId>com.goldin.plugins</groupId>
                <artifactId>maven-assert-plugin</artifactId>
                <version>${plugins-version}</version>
                <executions>
                    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
                    <!-- http://evgeny-goldin.org/youtrack/issue/pl-502 -->
                    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
                    <execution>
                        <id>http://evgeny-goldin.org/youtrack/issue/pl-502</id>
                        <goals>
                            <goal>assert</goal>
                        </goals>
                        <phase>test</phase>
                        <configuration>
                            <assertEqual>
                                <!-- No replaces -->
                                ${outputDir}/pl-502/1|${outputDir}/pl-502/copy-2|**/*.class
                                ${outputDir}/pl-502/1|${outputDir}/pl-502/copy-2|**/*.xml
                                ${outputDir}/pl-502/copy-2|${outputDir}/pl-502/unpack-2|**/*.class
                                ${outputDir}/pl-502/copy-2|${outputDir}/pl-502/unpack-2|**/*.xml
                                ${outputDir}/pl-502/unpack-2|${outputDir}/pl-502/pack-2/unpack|**/*.class
                                ${outputDir}/pl-502/unpack-2|${outputDir}/pl-502/pack-2/unpack|**/*.xml
                                ${outputDir}/pl-502/pack-2/unpack|${outputDir}/pl-502/1|**/*.class
                                ${outputDir}/pl-502/pack-2/unpack|${outputDir}/pl-502/1|**/*.xml
                                <!-- Replaces -->
                                ${outputDir}/pl-502/copy-1|${outputDir}/pl-502/unpack-1
                                ${outputDir}/pl-502/unpack-1|${outputDir}/pl-502/pack-1/unpack
                                ${outputDir}/pl-502/pack-1/unpack|${outputDir}/pl-502/copy-1
                            </assertEqual>
                            <shouldFailAssertEqual>
                                <!-- Non-matching patterns -->
                                ${outputDir}/pl-502/1|${outputDir}/pl-502/copy-2|*.class
                                ${outputDir}/pl-502/1|${outputDir}/pl-502/copy-2|**/*.ppt
                                <!-- Replaced vs. non-replaced files -->
                                ${outputDir}/pl-502/copy-1|${outputDir}/pl-502/copy-2
                                ${outputDir}/pl-502/copy-1|${outputDir}/pl-502/copy-2|**/*.class
                                ${outputDir}/pl-502/unpack-1|${outputDir}/pl-502/unpack-2
                                ${outputDir}/pl-502/unpack-1|${outputDir}/pl-502/unpack-2|**/*.class
                                ${outputDir}/pl-502/pack-1/unpack|${outputDir}/pl-502/pack-2/unpack
                                ${outputDir}/pl-502/pack-1/unpack|${outputDir}/pl-502/pack-2/unpack|**/*.class
                            </shouldFailAssertEqual>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

</project>
