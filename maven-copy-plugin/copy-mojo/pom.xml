<?xml version="1.0" encoding="UTF-8"?>

<project xmlns              = "http://maven.apache.org/POM/4.0.0"
         xmlns:xsi          = "http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation = "http://maven.apache.org/POM/4.0.0
                               http://maven.apache.org/maven-v4_0_0.xsd">

    <modelVersion>4.0.0</modelVersion>
    <groupId>com.goldin.plugins.maven-plugins-test</groupId>
    <artifactId>maven-copy-plugin.copy-mojo</artifactId>
    <packaging>jar</packaging>
    <version>0.1-SNAPSHOT</version>
    <name>[${project.groupId}:${project.artifactId}:${project.version}]</name>


    <parent>
        <groupId>com.goldin.plugins.maven-plugins-test</groupId>
        <artifactId>maven-copy-plugin</artifactId>
        <version>0.1-SNAPSHOT</version>
    </parent>


    <properties>
        <outputDir>${project.build.outputDirectory}</outputDir>
    </properties>


    <build>
        <plugins>

            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-jar-plugin</artifactId>
                <configuration>
                    <includes>
                        <include>**</include>
                    </includes>
                </configuration>
            </plugin>


            <plugin>
                <groupId>com.goldin.plugins</groupId>
                <artifactId>maven-copy-plugin</artifactId>
                <version>${maven-copy-plugin-version}</version>
                <executions>
                    <execution>
                        <id>test-copy-mojo</id>
                        <goals>
                            <goal>copy</goal>
                        </goals>
                        <phase>package</phase>
                        <configuration>
                            <resources>

                                <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
                                <!-- Testing "{{latest}}" filter -->
                                <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

                                <resource>
                                    <targetPath>${outputDir}/latestTest</targetPath>
                                    <file>${project.basedir}/pom.xml</file>
                                    <replace>
                                        <to>{{ new Date() }}</to>
                                        <groovy>true</groovy>
                                    </replace>
                                    <destFileName>aa.txt</destFileName>
                                </resource>
                                <resource>
                                    <targetPath>${outputDir}/latestTest</targetPath>
                                    <file>${project.basedir}/pom.xml</file>
                                    <replace>
                                        <to>{{ new Date() }}</to>
                                        <groovy>true</groovy>
                                    </replace>
                                    <destFileName>bb.txt</destFileName>
                                </resource>
                                <resource>
                                    <targetPath>${outputDir}/latestTestSelect</targetPath>
                                    <directory>${outputDir}/latestTest</directory>
                                    <filter>{{latest}}</filter>
                                </resource>

                                <!-- ~~~~~~~~~~~~~~~~~ -->
                                <!-- Testing "<runIf>" -->
                                <!-- ~~~~~~~~~~~~~~~~~ -->

                                <resource>
                                    <targetPath>${outputDir}/runIf</targetPath>
                                    <file>${project.basedir}/pom.xml</file>
                                    <replace>
                                        <to><!-- Nothing --></to>
                                    </replace>
                                    <destFileName>1.txt</destFileName>
                                </resource>
                                <resource>
                                    <!-- false -->
                                    <runIf>{{ 3 == 5 }}</runIf>
                                    <targetPath>${outputDir}/runIf</targetPath>
                                    <file>${project.basedir}/pom.xml</file>
                                    <destFileName>2.txt</destFileName>
                                </resource>
                                <resource>
                                    <!-- true -->
                                    <runIf>{{ System.currentTimeMillis() > 0 }}</runIf>
                                    <targetPath>${outputDir}/runIf</targetPath>
                                    <file>${project.basedir}/pom.xml</file>
                                    <destFileName>3.txt</destFileName>
                                </resource>
                                <resource>
                                    <!-- false -->
                                    <runIf>{{ "null" }}</runIf>
                                    <targetPath>${outputDir}/runIf</targetPath>
                                    <file>${project.basedir}/pom.xml</file>
                                    <destFileName>4.txt</destFileName>
                                </resource>

                                <!-- ~~~~~~~~~~~~~~~~~~~~~~~~ -->
                                <!-- Testing "failIfNotFound" -->
                                <!-- ~~~~~~~~~~~~~~~~~~~~~~~~ -->

                                <resource>
                                    <targetPath>${outputDir}/failIfNotFound</targetPath>
                                    <file>${project.basedir}/pom-doesnot-exist.xml</file>
                                    <failIfNotFound>false</failIfNotFound>
                                </resource>

                                <!-- ~~~~~~~~~~~~~~~~~~~~~ -->
                                <!-- Testing Net resources -->
                                <!-- ~~~~~~~~~~~~~~~~~~~~~ -->

                                <resource>
                                    <targetPath>${outputDir}/net-http</targetPath>
                                    <file>http://dl.dropbox.com/u/4820835/search.png</file>
                                </resource>
                                <resource>
                                    <targetPath>${outputDir}/net-http</targetPath>
                                    <file>http://dl.dropbox.com/u/4820835/hudson-maven-git-NPE/debugger.png</file>
                                </resource>
                                <resource>
                                    <targetPath>${outputDir}/net-ftp/1</targetPath>
                                    <directory>ftp://evgenyg_zxq:sdaed432e23@evgenyg.zxq.net:/</directory>
                                    <include>index.html</include>
                                </resource>
                                <resource>
                                    <targetPath>${outputDir}/net-ftp/2</targetPath>
                                    <directory>ftp://evgenyg_zxq:sdaed432e23@evgenyg.zxq.net:/apache-maven-3.0.1</directory>
                                    <include>lib/no-such-file*.jar</include>
                                    <failIfNotFound>false</failIfNotFound>
                                </resource>
                                <resource>
                                    <targetPath>${outputDir}/net-ftp/3</targetPath>
                                    <directory>ftp://evgenyg_zxq:sdaed432e23@evgenyg.zxq.net:/apache-maven-3.0.1/lib</directory>
                                    <include>wagon-*.jar</include>
                                    <exclude>wagon-http-*.jar</exclude>
                                </resource>
                                <resource>
                                    <targetPath>${outputDir}/net-ftp/4</targetPath>
                                    <directory>ftp://evgenyg_zxq:sdaed432e23@evgenyg.zxq.net:/apache-maven-3.0.1</directory>
                                    <include>file:${project.basedir}/src/main/resources/ftp-include.txt</include>
                                    <exclude>classpath:/ftp-exclude.txt</exclude>
                                </resource>
                            </resources>
                        </configuration>
                    </execution>
                </executions>
                <dependencies>
                    <dependency>
                        <groupId>com.goldin.plugins.maven-plugins-test</groupId>
                        <artifactId>maven-copy-plugin.copy-mojo</artifactId>
                        <version>0.1-SNAPSHOT</version>
                    </dependency>
                </dependencies>
            </plugin>

            <plugin>
                <groupId>com.goldin.plugins</groupId>
                <artifactId>maven-assert-plugin</artifactId>
                <version>${maven-assert-plugin-version}</version>
                <executions>
                    <execution>
                        <id>assert-copy-mojo</id>
                        <goals>
                            <goal>assert</goal>
                        </goals>
                        <phase>install</phase>
                        <configuration>
                            <assertFiles>
                                ${outputDir}/latestTestSelect/bb.txt
                                ${outputDir}/runIf/1.txt
                                ${outputDir}/runIf/3.txt
                                ${outputDir}/net-http/search.png
                                ${outputDir}/net-http/debugger.png
                                ${outputDir}/net-ftp/1/index.html
                                ${outputDir}/net-ftp/3/wagon-file-1.0-beta-7.jar
                                ${outputDir}/net-ftp/3/wagon-provider-api-1.0-beta-7.jar
                                ${outputDir}/net-ftp/4/mvn
                                ${outputDir}/net-ftp/4/mvn.bat
                                ${outputDir}/net-ftp/4/mvnyjp
                            </assertFiles>
                            <assertGroovy>
                                new File( outputDir, 'latestTestSelect/bb.txt' ).text
                              ! new File( outputDir, 'runIf/1.txt' ).text
                                new File( outputDir, 'runIf/3.txt' ).text
                                new File( outputDir, 'runIf' ).list().size() == 2
                              ! new File( outputDir, 'failIfNotFound' ).isDirectory()
                                new File( outputDir, 'net-http/search.png'   ).size() == 987
                                new File( outputDir, 'net-http/debugger.png' ).size() == 193080
                              ! new File( outputDir, 'net-ftp/2' ).isDirectory()
                                new File( outputDir, 'net-ftp/3' ).list().size()   == 2
                                new File( outputDir, 'net-ftp/3' ).directorySize() == 64290
                                new File( outputDir, 'net-ftp/4' ).list().size()   == 3
                                new File( outputDir, 'net-ftp/4' ).directorySize() == 15438
                            </assertGroovy>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

</project>
